{% extends "layout.html" %}

{% block navigation %}
    <ul class="nav nav-stacked nav-title">
        {% for category in nav %}
        <li class="layui-nav-item">
            <a href="{{ category.Name }}">{{ category.Title }}</a>
            <ul class="sub-menu scroll">
                {% for option in category.Option %}
                <li>
                    <a href="{{category.Name}}#{{ option.Title }}">{{ option.Title }}</a>
                </li>
                {% endfor %}
                <li><button class="optionBtn btn" data-toggle="modal" data-target="#optionForm" data-categoryid="{{ category.Category_id }}">添加选项</button></li>
            </ul>
        </li>
        {% endfor %}
        <button class="btn" data-toggle="modal" data-target="#categoryForm">添加分类</button>
    </ul>

    <!-- category 表单的模态框 -->
    <div class="modal fade" id="categoryForm">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form action="/add/category" method="post" role="form">
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" class="form-control" name="name">
                        </div>
                        <div class="form-group">
                            <label>标题:</label>
                            <input type="text" class="form-control" name="title">
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                            <button type="submit" class="btn btn-default">提交</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    
        <!-- option 表单的模态框 -->
        <div class="modal fade" id="optionForm">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form action="/add/option" method="post" role="form">
                        <input type="hidden" class="form-control" name="category_id" id="categoryid">
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" class="form-control" name="name">
                        </div>
                        <div class="form-group">
                            <label>标题:</label>
                            <input type="text" class="form-control" name="title">
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                            <button type="submit" class="btn btn-default">提交</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
{% endblock%}

{% block content %}
    <!-- 面包屑导航 -->
    {% if username %}
        <p class="navbar-text">
            <span>Welcome, {{ username }}</span>
            <span>&nbsp;|&nbsp</span>
            <a class="navbar-link" href="/user/loginout">Logout</a>
        </p>
    {% endif %}
    
    <!-- 所有的数据都显示在这里 -->
    {% for category in results %}
        <a href="#"><p>{{ category.Title }}</p></a> 
            <ul>
                {% for option in category.Option %}
                    <li id="{{ option.Title }}">{{ option.Title }}</li>
                    <ol>
                        {% for card in option.Card %}
                        <a href=""><li>{{ card.Title }}</li></a>
                        <ul>
                            <li>{{ card.ImageUrl }}</li>
                            <li>{{ card.Describe }}</li>
                            <li>{{ card.Url }}</li>
                        </ul>
                        {% endfor %}
                        <li><button class="cardBtn btn" data-toggle="modal" data-target="#cardForm" data-optionid="{{ option.Option_id }}">添加卡片</button></li>
                    </ol>
                {% endfor %}
            </ul>
    {% endfor %}

    <!-- card 表单的模态框 -->
    <div class="modal fade" id="cardForm">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/add/card?_csrf={{ ctx.csrf | safe }}" method="post" role="form" enctype="multipart/form-data">
                    <input type="hidden" class="form-control" name="option_id" id="cardid"> 
                    <div class="form-group">
                        <label>Title:</label>
                        <input type="text" class="form-control" name="title">
                    </div>
                    <div class="form-group">
                        <label>Describe:</label>
                        <input type="text" class="form-control" name="describe">
                    </div>
                    <div class="form-group">
                        <label>Url:</label>
                        <input type="text" class="form-control" name="url">
                    </div>
                    <div class="form-group">
                        <label>Image:</label>
                        <input type="file" class="form-control" name="image">
                    </div>
                    <div class="form-group">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="submit" class="btn btn-default">提交</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}